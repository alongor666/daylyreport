# 每日签单平台趋势分析系统

一个用于车险签单数据分析和可视化的Web应用系统。

## 功能特性

### 📊 核心功能
- **自动数据清洗**: 每日自动处理新增的Excel签单清单
- **日报KPI展示**: 签单保费、保单件数、手续费、目标差距
- **趋势分析**: 支持7天和3周的签单保费趋势对比
- **动态X轴**: 根据最新数据自动调整周几的显示
- **实时刷新**: 支持手动和自动数据刷新

### 🎨 界面特色
- 现代化渐变设计
- 响应式布局(支持PC和移动端)
- ECharts交互式图表
- 流畅的动画效果

## 项目结构

```
daylyreport/
├── backend/                      # 后端服务
│   ├── data_processor.py        # 数据处理模块
│   └── api_server.py            # Flask API服务器
├── static/                       # 前端资源
│   ├── index.html               # 主页面
│   ├── css/
│   │   └── style.css            # 样式文件
│   └── js/
│       └── app.js               # 应用逻辑
├── data/                         # 数据目录(放置Excel文件)
│   └── processed/               # 已处理文件存档
├── requirements.txt             # Python依赖
├── start_server.bat             # Windows启动脚本
└── README.md                    # 项目文档
```

## 快速开始

### 1. 环境要求
- Python 3.8+
- 现代浏览器(Chrome/Edge/Firefox)

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 准备数据

将每日的Excel签单清单文件放入 `data/` 目录:

```
data/
├── 2025-11-05_签单清单.xlsx
├── 2025-11-06_签单清单.xlsx
└── ...
```

### 4. 启动服务

**方式一: 使用启动脚本(推荐)**

Windows双击运行: `start_server.bat`

**方式二: 手动启动**

```bash
cd backend
python api_server.py
```

### 5. 访问系统

打开浏览器访问: `http://localhost:5000/static/index.html`

## 使用说明

### 数据更新流程

1. **新增数据**: 将新的Excel文件放入 `data/` 目录
2. **自动处理**: 点击网页上的"刷新数据"按钮
3. **系统清洗**: 自动将Excel转为CSV并合并到主数据文件
4. **实时展示**: 网页自动更新最新的KPI和趋势图

### Excel文件要求

- 格式必须与标准签单清单一致(包含: 投保确认时间、签单保费、签单数量等字段)
- 支持 `.xlsx` 和 `.xls` 格式
- 文件会自动去重(根据保单号和投保确认时间)

### KPI指标说明

- **签单总保费**: 当日所有保单的签单保费总和
- **保单件数**: 当日签单的保单数量
- **手续费**: 当日手续费含税总额
- **目标差距**: 与日目标(20万)的差距,正数表示超额完成

### 趋势图说明

- **近7天**: 显示连续7天的数据,X轴为周几(周一~周日)
- **近3周**: 显示连续21天的数据,X轴为周几
- **双Y轴**: 左侧为签单保费(柱状图),右侧为保单件数(折线图)
- **动态标签**: 鼠标悬停显示详细数据

## API接口

### POST /api/refresh
刷新数据,处理新的Excel文件

### GET /api/daily-report
获取日报数据

参数:
- `date` (可选): 指定日期,格式 YYYY-MM-DD

### GET /api/week-trend
获取周趋势数据

参数:
- `weeks` (可选): 周数,1或3,默认1
- `end_date` (可选): 结束日期,格式 YYYY-MM-DD

### GET /api/latest-date
获取数据中的最新日期

### GET /api/health
健康检查

## 数据清洗规则

系统会自动执行以下清洗操作:

1. ✅ 删除完全为空的行
2. ✅ 日期格式标准化
3. ✅ 数值类型转换
4. ✅ 缺失值填充
5. ✅ 数据去重(根据保单号和投保确认时间)
6. ✅ 与历史数据合并

## 常见问题

### Q: 为什么点击刷新后没有数据?
A: 请检查:
1. `data/` 目录是否有Excel文件
2. Excel文件格式是否正确
3. 后端控制台是否有错误信息

### Q: 图表显示不正常?
A: 请检查:
1. 浏览器控制台是否有错误
2. 是否有网络拦截(检查CORS)
3. 尝试刷新页面或清除缓存

### Q: 如何修改日目标?
A: 在 `backend/data_processor.py` 的 `get_daily_report()` 方法中修改 `daily_target` 变量

### Q: 支持哪些浏览器?
A: 支持所有现代浏览器:
- Chrome 90+
- Edge 90+
- Firefox 88+
- Safari 14+

## 技术栈

### 后端
- **Flask**: Web框架
- **Pandas**: 数据处理
- **openpyxl**: Excel文件读取

### 前端
- **原生HTML/CSS/JS**: 无框架依赖
- **ECharts 5.x**: 图表库
- **Fetch API**: 数据请求

## 开发计划

- [ ] 支持多维度筛选(机构/团队/业务员)
- [ ] 增加更多图表类型(饼图/排行榜)
- [ ] 数据导出功能
- [ ] 用户权限管理
- [ ] 移动端App

## 许可证

MIT License

## 联系方式

如有问题或建议,请联系项目维护者。

---

**Made with ❤️ for 车险业务团队**
