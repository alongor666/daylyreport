# 车险日报可视化 · PRD（活文档）

## 一、目标与范围
- 目标：面向管理层的本地可视化看板，快速掌握区间业绩与结构。
- 数据范围：目录中的保/批单日报xlsx；忽略 `混乱/` 子目录；日期从文件名解析。

## 二、核心指标与口径
- 单位统一：前端展示为“万元”（÷10000），保留两位小数。
- 指标定义：
  - 净保费：签单保费合计（原保为正；批单按净额正负）。
  - 原保保费：原保合计。
  - 批单保费净额：批单净额合计。
  - 交强保费 / 商业保费：按 `险种名称` 分类。
  - 商险占比 / 交强占比：对应保费 / 净保费。
  - 件数：原保件数、批单件数、总件数。

## 三、功能列表
- 日期区间选择与刷新。
- KPI卡片：净保、原保、批单净额、总件数、商险占比、交强占比。
- 图表：
  - 净保费趋势（折线）
  - 原保与批单保费（堆叠柱）
  - 交强 vs 商业（双折线）
  - 月度净保费对比（柱状）
  - 机构Top10、渠道Top10（条形，带数值标签、单位万元）
- 质量检查：负保费记录、重复保单号明细。

## 四、数据结构与映射
- 输入列名兼容：`COLUMN_SYNONYMS`（见 `generate_daily_report.py`）统一映射为标准列。
- 必备标准列：`报告日期`、`所属机构`、`渠道名称`、`保单号`、`批单号`、`是否原保`、`是否批单`、`险种名称`、`原保保费`、`批单保费净额`、`签单保费`。
- 日期解析：优先使用文件名中的 `YYYYMMDD`；其次使用表内 `报告日期`。

## 五、交互与设计
- 设计风格：苹果发布会风格，深色极简，强调数据与对比关系。
- 提示与格式：中文提示、千分位格式；坐标轴统一 `单位：万元`。
- 弹窗：质量检查支持关闭与滚动查看表格。

## 六、规则维护与扩展
- 批单符号规则：如需细分批次类型与符号（例如退保、批改），在 `assign_signed_premium` 中维护并于此处记录。
- 险种分类：可扩展至更细分类（如车损、三者等），在前端新增维度图表、后端增加聚合。
- 去重策略：如需对保单号去重或取最新版本，可在加载阶段增加去重逻辑并在此处说明。

## 七、质量控制
- 负保费：应重点关注，结合批单类型判断是否合理。
- 重复保单号：需排查是否同一保单多次导入或版本更新。
- 质量报告：作为每日检查的一部分，纳入管理例会。

## 八、版本与迭代
- v1.1：新增KPI卡片、质量检查弹窗、月度对比、Top10数值标签。
- 迭代计划：
  - KPI卡片增加环比/同比
  - 机构与渠道层级展开
  - 数据质量规则白名单与忽略机制

（本PRD为活文档，随系统功能变化同步更新）