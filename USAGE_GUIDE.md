# 使用指南

## 快速启动(3步)

### 第1步: 安装依赖

打开命令行,进入项目目录:

```bash
cd "d:\WPS+iMac\车险签单清单_2025年3月\daylyreport"
pip install -r requirements.txt
```

### 第2步: 启动服务器

双击运行 `start_server.bat` 或在命令行执行:

```bash
start_server.bat
```

你会看到:

```
========================================
   每日签单平台趋势分析系统
========================================

[1/3] 检查Python环境...
✓ Python环境正常

[2/3] 检查依赖包...
✓ 依赖包已安装

[3/3] 启动API服务器...

========================================
 服务器地址: http://localhost:5000
 网页访问: http://localhost:5000/static/index.html
========================================
```

### 第3步: 打开浏览器

访问: http://localhost:5000

或者: http://localhost:5000/static/index.html

---

## 日常使用流程

### 场景1: 每日数据更新

**步骤:**

1. 将今天的Excel签单清单文件保存到 `data/` 目录

   ```
   data/
   └── 2025-11-06_签单清单.xlsx  ← 新增文件
   ```

2. 打开网页,点击右上角 `🔄 刷新数据` 按钮

3. 等待处理完成(通常1-3秒)

4. 看到成功提示: "数据刷新成功!"

5. 页面自动更新最新的KPI和趋势图

**注意事项:**
- Excel文件名可以任意命名
- 系统会自动去重,不用担心重复导入
- 处理后的文件会移动到 `data/processed/` 目录

---

### 场景2: 查看历史趋势

**切换时间范围:**

- 点击 `近7天` 按钮: 显示最近7天的数据
- 点击 `近3周` 按钮: 显示最近21天的数据

**图表功能:**
- 🖱️ **悬停查看**: 鼠标移到柱子或折线点上,显示详细数据
- 📊 **双Y轴**: 左边是保费,右边是件数
- 📅 **动态X轴**: 自动显示周几(周一到周日)

---

### 场景3: 监控KPI指标

页面顶部显示4个KPI卡片:

1. **💰 签单总保费**
   - 显示最新日期的签单保费总额
   - 例: ¥125,678.90

2. **📋 保单件数**
   - 显示最新日期的保单数量
   - 例: 234

3. **💵 手续费**
   - 显示最新日期的手续费总额
   - 例: ¥5,027.16

4. **🎯 目标差距**
   - 与日目标(20万)的差距
   - 绿色↑: 超额完成
   - 红色↓: 未达目标

---

## 数据文件管理

### Excel文件要求

✅ **支持的格式:**
- `.xlsx` (推荐)
- `.xls`

✅ **必须包含的字段:**
- 投保确认时间
- 签单/批改保费
- 签单数量
- 手续费含税
- 保单号

❌ **不支持:**
- CSV文件(请用Excel格式)
- 损坏的Excel文件

### 数据目录结构

```
data/
├── 2025-11-05_签单清单.xlsx     ← 待处理
├── 2025-11-06_签单清单.xlsx     ← 待处理
└── processed/                    ← 已处理(自动归档)
    ├── 2025-11-05_签单清单_processed_20251106_083015.xlsx
    └── 2025-11-06_签单清单_processed_20251106_141230.xlsx
```

### 合并后的数据

所有数据会合并到项目根目录的:

```
车险清单_2025年10-11月_合并.csv
```

**特点:**
- UTF-8编码
- 自动去重
- 包含所有历史数据

---

## 常见操作

### 修改日目标值

编辑文件: `backend/data_processor.py`

找到第140行左右:

```python
# 计算目标差距(假设日目标为20万保费)
daily_target = 200000  # ← 修改这个值
report['target_gap'] = report['premium'] - daily_target
```

修改 `daily_target` 的值,例如改为30万:

```python
daily_target = 300000
```

保存后重启服务器。

---

### 导出当前数据

合并后的CSV文件位于:

```
车险清单_2025年10-11月_合并.csv
```

可以直接用Excel打开或导入其他系统。

---

### 清空所有数据(重新开始)

1. 停止服务器(Ctrl+C)
2. 删除文件: `车险清单_2025年10-11月_合并.csv`
3. 删除 `data/` 和 `data/processed/` 中的所有文件
4. 重新启动服务器
5. 重新导入数据

---

## 故障排查

### 问题1: 服务器启动失败

**症状:**
```
ModuleNotFoundError: No module named 'flask'
```

**解决:**
```bash
pip install -r requirements.txt
```

---

### 问题2: 页面显示"加载中..."一直不结束

**可能原因:**
1. 后端服务未启动
2. 数据文件不存在
3. CSV文件格式错误

**排查步骤:**
1. 检查后端是否在运行(命令行窗口应该有输出)
2. 检查是否有 `车险清单_2025年10-11月_合并.csv` 文件
3. 打开浏览器控制台(F12),查看错误信息

---

### 问题3: 刷新数据后没有变化

**可能原因:**
1. `data/` 目录为空
2. Excel文件格式不正确
3. 数据被去重了(已经存在)

**解决:**
1. 确认 `data/` 目录有Excel文件
2. 查看后端控制台输出,是否有错误信息
3. 检查Excel文件是否包含必需字段

---

### 问题4: 图表显示异常

**解决方法:**
1. 按 Ctrl+F5 强制刷新页面
2. 清除浏览器缓存
3. 更换浏览器(推荐Chrome)

---

## 性能优化

### 数据量很大时(>10万行)

**优化建议:**

1. **定期归档**: 每个月将老数据移出CSV文件
2. **分批导入**: 不要一次导入太多文件
3. **增加内存**: 确保电脑有足够内存

### 提高刷新速度

系统会自动每5分钟刷新一次数据。

如果想修改频率,编辑 `static/js/app.js` 第24行:

```javascript
// 每5分钟自动刷新一次
setInterval(() => {
    console.log('⏰ 自动刷新数据...');
    loadAllData();
}, 5 * 60 * 1000);  // ← 修改这个值(单位:毫秒)
```

例如改为每10分钟:

```javascript
}, 10 * 60 * 1000);
```

---

## 快捷键

- `F5`: 刷新页面
- `Ctrl+F5`: 强制刷新(清除缓存)
- `F12`: 打开开发者工具
- `Ctrl+C`: 停止服务器(在命令行窗口)

---

## 支持的浏览器

| 浏览器 | 最低版本 | 推荐版本 |
|--------|---------|----------|
| Chrome | 90+     | 最新版   |
| Edge   | 90+     | 最新版   |
| Firefox| 88+     | 最新版   |
| Safari | 14+     | 最新版   |

**不支持:** IE浏览器

---

## 技术支持

如遇到问题:

1. 查看 `README.md` 常见问题章节
2. 查看后端控制台的错误信息
3. 查看浏览器控制台(F12)的错误信息
4. 联系技术支持团队

---

**祝使用愉快!** 📊✨
