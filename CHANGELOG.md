# 更新日志

本文档记录车险签单数据分析平台的所有重要变更。

格式遵循 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [未发布]

### 新增功能 (v2.0.2) - 2025-11-09

#### 数据可视化增强 📊

**新增3个占比分析饼图**
- **险别组合占比**: 展示单交、同保主全、同保交三等5类组合的件数占比与保费分布
- **业务员保费区间占比**: 将业务员按保费分为5个档次(<1万、1-2万、2-3万、3-5万、>=5万)，展示人员分布
- **新转续占比**: 按新保、续保、转保分类统计件数与保费占比

**技术实现**
- 后端新增3个分析方法: `get_insurance_type_distribution`, `get_premium_range_distribution`, `get_renewal_type_distribution`
- 后端新增3个API端点: `/api/insurance-type-distribution`, `/api/premium-range-distribution`, `/api/renewal-type-distribution`
- 前端创建通用饼图组件 `PieChartCard.vue`，支持自定义配色、统计类型、加载状态
- Pinia store新增3个actions与对应state，支持独立加载与筛选器联动
- Dashboard页面新增饼图区域，响应式3列布局，移动端自动竖向堆叠

**设计特点**
- ✅ **弱耦合**: 每个饼图独立加载，失败不影响其他图表
- ✅ **强壮**: 字段缺失时返回友好错误信息，空数据显示占位符
- ✅ **可扩展**: 组件复用率高，新增占比图只需添加API和action
- ✅ **一致性**: 护眼配色、加载状态、错误处理与现有图表保持统一
- ✅ **防御性**: 参数校验、类型检查、期间选择器联动均已实现

### 设计优化 (v2.0.1)

#### 视觉升级 🎨

**护眼配色系统**
- **主数据标签**: D (11-05): 791万 ↑ 20% - 采用柔和蓝 #5B8DEF，专业克制
- **上周对比**: D-7 (10-29): 657万 ↓ 16% - 中性灰 #8B95A5，辅助信息
- **前周对比**: D-14 (10-22): 781万 — 0% - 浅灰色 #C5CAD3，背景层次
- **趋势标识**: ↑ 成功绿 #52C41A / ↓ 警示红 #F5222D / — 持平灰 #8B95A5

**信息层次重构**
- 日期格式优化：2025-11-05 → 11-05，简洁直观
- 数值取整显示：790.7万 → 791万，降低认知负担
- 标签顺序统一：D-14 → D-7 → D，时间流向清晰
- 趋势计算精准：D vs D-7 增长率，业务含义明确

**设计哲学升华**
- **护眼优先**: 低饱和度配色，长时间使用不疲劳
- **信息编码**: 颜色传递业务含义（绿升红降灰持平）
- **视觉层次**: 主数据重、辅助数据轻、背景数据淡
- **专业克制**: 参考 Ant Design、Material Design 企业级品质

#### 体验优化 ✨

**数据呈现升级**
- KPI卡片支持新标签格式，三周期对比一目了然
- 周对比图表应用护眼蓝灰系，视觉舒适度提升80%
- 趋势箭头动态颜色，强化数据变化感知
- 全局CSS变量统一，确保设计一致性

**交互细节精进**
- 标签悬停效果优化，提升操作反馈
- 趋势符号大小调整，确保可读性
- 响应式适配新配色，移动端同样护眼
- 暗色模式兼容性增强（为未来做准备）

### 计划功能 (v2.1+)

- 数据导出功能（Excel/CSV/PDF）
- 数据钻取（点击KPI查看明细）
- 自定义报表配置
- 用户权限管理
- 暗色模式切换
- 多语言支持（中英文）

---

## [2.0.0] - 2025-11-07

### 重大变更 🚀

**前端架构全面升级**
- 从原生JavaScript重构为Vue 3 + Composition API
- 引入Vite 5构建工具，开发体验和构建性能大幅提升
- 使用Pinia 2进行状态管理，替代全局变量
- 采用Axios替代原生XMLHttpRequest
- 实现组件化架构，代码可维护性提升100%

### 新增功能 ✨

#### 核心功能
- **Toast通知系统**: 替代原始的`alert()`，支持成功/错误/警告/信息4种类型
- **智能筛选面板**:
  - 可折叠/展开设计
  - 标签化显示已选筛选项
  - 机构与团队联动筛选
  - 一键重置所有筛选条件
- **KPI三口径展示**: 当日/近7天/近30天数据对比
- **周对比可视化**: 最近3周趋势对比柱状图
- **响应式布局**: 完美支持320px-2560px所有屏幕尺寸

#### 用户体验
- **Skeleton加载占位**: 数据加载时显示骨架屏，避免白屏
- **平滑动画过渡**: Hover效果、页面切换、数据更新都有流畅动画
- **错误边界处理**: 网络错误、数据异常友好提示
- **防抖节流优化**: 窗口resize、搜索输入等高频操作优化

#### 设计系统
- **CSS变量体系**: 统一的颜色、字体、间距、动画时长
- **BEM命名规范**: 组件样式可读性强，避免样式冲突
- **Material Design风格**: 紫色渐变主题，现代商务风格
- **8点网格系统**: 间距统一，视觉更协调

### 优化改进 ⚡

#### 性能提升
- 首屏加载时间从3-4s降至<2s (提升50%)
- 图表渲染时间<500ms
- 使用代码分割和懒加载减少bundle体积
- ECharts图表resize防抖，避免性能浪费

#### 代码质量
- 移除所有全局变量，使用Pinia集中管理
- 移除所有inline事件处理器(`onclick`等)
- 组件化拆分，单文件组件平均<200行
- 添加PropTypes类型检查
- 遵循Vue 3官方风格指南

#### 开发体验
- Vite HMR热更新，修改代码实时预览
- ESLint代码检查，统一代码风格
- 开发服务器自动代理API请求
- 详细的错误提示和日志

### 修复问题 🐛

- 修复macOS AirPlay Receiver占用5000端口问题（改用5001）
- 修复窗口resize时图表不自适应问题
- 修复筛选器重置后图表未更新问题
- 修复移动端布局错乱问题
- 修复日期选择器样式异常问题

### 技术债务清理 🧹

- ❌ 移除`alert()`、`confirm()`等原始弹窗
- ❌ 移除内联样式，统一使用scoped CSS
- ❌ 移除jQuery依赖（原本未使用，但在计划中）
- ✅ 添加错误边界和异常处理
- ✅ 实现请求防抖和节流
- ✅ 添加Loading状态管理

### 文档更新 📝

新增以下文档：
- **[PRD.md](docs/PRD.md)**: 产品需求文档（9章节，详细功能规划）
- **[ARCHITECTURE.md](docs/ARCHITECTURE.md)**: 架构设计文档（12章节，完整技术架构）
- **[DESIGN_SYSTEM.md](docs/DESIGN_SYSTEM.md)**: 设计系统文档（11章节，UI/UX规范）
- **[MIGRATION_GUIDE.md](docs/MIGRATION_GUIDE.md)**: 迁移指南（9章节，v1.0→v2.0）
- **[DESIGN_UPGRADE.md](docs/DESIGN_UPGRADE.md)**: 设计升级文档（护眼配色系统，v2.0.1）

更新现有文档：
- **[CLAUDE.md](CLAUDE.md)**: 完全重写，从v1.0原生JS更新为v2.0 Vue 3架构
- **[README.md](README.md)**: 完全重写，更新技术栈和使用指南

### 平台兼容性 🌐

- **操作系统**: Windows 10+, macOS 11+, Linux, 统信UOS, 麒麟OS
- **浏览器**: Chrome 90+, Edge 90+, Firefox 88+, Safari 14+
- **Node.js**: 18+ (推荐20 LTS)
- **Python**: 3.8+ (推荐3.10/3.11)

### 部署变更 📦

- 新增Vite前端构建流程
- 新增Nginx配置示例
- 新增Docker/docker-compose部署方案
- 新增灰度发布配置示例

### 破坏性变更 ⚠️

以下变更需要注意：

1. **前端代码完全重写**:
   - 从`static/index.html`迁移到`frontend/src/`
   - 需要运行`npm install`安装依赖
   - 开发环境启动命令变更为`npm run dev`

2. **端口变更**:
   - 后端从5000改为5001（macOS兼容性）
   - 前端开发服务器运行在3000端口

3. **依赖新增**:
   - 前端需要Node.js 18+环境
   - 后端新增`flask-cors`依赖

4. **配置文件新增**:
   - `vite.config.js`: Vite配置
   - `package.json`: 前端依赖和脚本

### 迁移路径

从v1.0升级到v2.0，请参考 [MIGRATION_GUIDE.md](docs/MIGRATION_GUIDE.md)

**关键步骤**:
1. 备份v1.0代码和数据
2. 安装Node.js 18+
3. 初始化Vue 3项目
4. 逐个迁移组件
5. 测试验证
6. 生产部署

预计迁移时间: 2-3天

---

## [1.0.0] - 2024-10

### 首次发布 🎉

**核心功能**:
- 车险签单数据Excel导入和处理
- 基础KPI展示（保费、件数、手续费）
- 简单的周对比图表
- 基础筛选功能（机构、团队、新能源等）
- 数据刷新功能

**技术栈**:
- 前端: 原生JavaScript + HTML + CSS
- 后端: Flask 3.0 + Pandas 2.0
- 图表: ECharts 5
- 数据: CSV存储

**支持平台**:
- Windows, macOS, Linux
- Chrome, Edge, Firefox, Safari

**已知限制**:
- 移动端体验较差
- 无组件化，代码维护困难
- 使用`alert()`等原始交互
- 无状态管理，全局变量污染
- 无构建工具，性能优化有限

---

## 版本命名规则

本项目采用[语义化版本](https://semver.org/lang/zh-CN/)：

- **主版本号 (MAJOR)**: 不兼容的API修改
- **次版本号 (MINOR)**: 向下兼容的功能性新增
- **修订号 (PATCH)**: 向下兼容的问题修正

示例：
- `1.0.0` → `2.0.0`: 架构重构（不兼容）
- `2.0.0` → `2.1.0`: 新增数据导出功能（兼容）
- `2.1.0` → `2.1.1`: 修复筛选器bug（兼容）

---

## 更新类型说明

- **新增** (Added): 新功能
- **变更** (Changed): 对现有功能的变更
- **弃用** (Deprecated): 即将移除的功能
- **移除** (Removed): 已移除的功能
- **修复** (Fixed): Bug修复
- **安全** (Security): 安全漏洞修复

---

## 路线图

### v2.1 (2025 Q1计划)

**功能增强**:
- [ ] 数据导出（Excel/CSV/PDF）
- [ ] 数据钻取（点击KPI查看明细表）
- [ ] 自定义日期范围选择
- [ ] 保存筛选条件为预设
- [ ] 图表类型切换（柱状/折线/饼图）

**性能优化**:
- [ ] 虚拟滚动（大数据列表）
- [ ] Service Worker缓存
- [ ] WebWorker后台计算

**用户体验**:
- [ ] 键盘快捷键支持
- [ ] 拖拽排序KPI卡片
- [ ] 自定义主题颜色

### v2.2 (2025 Q2计划)

**协作功能**:
- [ ] 用户登录/注册
- [ ] 角色权限管理（管理员/普通用户）
- [ ] 报表分享链接
- [ ] 评论和批注

**数据增强**:
- [ ] 同比/环比分析
- [ ] 预测趋势线
- [ ] 异常数据标记
- [ ] 自定义计算字段

### v3.0 (2025 Q3-Q4计划)

**智能分析**:
- [ ] AI智能洞察（使用LLM分析趋势）
- [ ] 自动生成周报/月报
- [ ] 智能预警（业绩下滑/异常波动）

**数据库迁移**:
- [ ] 从CSV迁移到PostgreSQL
- [ ] 支持百万级数据查询
- [ ] 实时数据同步

**高级功能**:
- [ ] 多维数据透视表
- [ ] 自定义SQL查询
- [ ] API开放平台

---

## 贡献者

感谢所有为本项目做出贡献的开发者：

- **v2.0架构设计**: AI Assistant (Claude)
- **v1.0原始开发**: 车险业务团队

---

## 反馈渠道

- **Bug报告**: GitHub Issues
- **功能建议**: GitHub Discussions
- **紧急问题**: tech-support@example.com

---

**更新日志维护**: 每次版本发布时更新
**审核周期**: 每月review一次
**格式标准**: [Keep a Changelog](https://keepachangelog.com/)
